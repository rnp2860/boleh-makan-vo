# ğŸ” Food Search Flow Diagram

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ User types query
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FoodSearch Component                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ <input> "nasi lemak rendang"                                  â”‚  â”‚
â”‚  â”‚ [Debounce 300ms] â†’ Prevents excessive API calls               â”‚  â”‚
â”‚  â”‚ [Cancel previous requests] â†’ Cleanup                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ API Call
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    /api/foods/search?q=...                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Next.js API Route                                             â”‚  â”‚
â”‚  â”‚ â€¢ Validates query                                             â”‚  â”‚
â”‚  â”‚ â€¢ Calls Supabase RPC                                          â”‚  â”‚
â”‚  â”‚ â€¢ Transforms results                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ RPC Call
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPABASE DATABASE                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ search_malaysian_foods('nasi lemak rendang', 20)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Execute search
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SEARCH ALGORITHM                                  â”‚
â”‚                                                                      â”‚
â”‚  Step 1: TOKENIZE                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Input:  "nasi lemak rendang"                                â”‚   â”‚
â”‚  â”‚ Output: ["nasi", "lemak", "rendang"]                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Step 2: MATCH (Multiple Strategies)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Priority 1: Exact Match                                     â”‚   â”‚
â”‚  â”‚   "nasi lemak" = name_en                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ Priority 2: Starts With                                     â”‚   â”‚
â”‚  â”‚   name_en LIKE 'nasi lemak%'                                â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ Priority 3: All Words Present (COMPOUND)                    â”‚   â”‚
â”‚  â”‚   name_en contains "nasi" AND "lemak" AND "rendang"         â”‚   â”‚
â”‚  â”‚   âœ… This is the key feature!                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ Priority 4: Contains Query                                  â”‚   â”‚
â”‚  â”‚   name_en LIKE '%nasi lemak%'                               â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ Priority 5: Alias Match                                     â”‚   â”‚
â”‚  â”‚   'ckt' IN aliases                                          â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚ Priority 6: Individual Words                                â”‚   â”‚
â”‚  â”‚   name_en contains "nasi" OR "lemak" OR "rendang"           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Step 3: RANK                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Score Calculation:                                          â”‚   â”‚
â”‚  â”‚  - Exact match:        +1000 points                         â”‚   â”‚
â”‚  â”‚  - Starts with:        +500 points                          â”‚   â”‚
â”‚  â”‚  - All words present:  +300 points                          â”‚   â”‚
â”‚  â”‚  - Per matching word:  +50 points each                      â”‚   â”‚
â”‚  â”‚  - Alias match:        +200 points                          â”‚   â”‚
â”‚  â”‚  - Popularity boost:   +(score Ã— 0.1)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Step 4: SORT & LIMIT                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ORDER BY:                                                   â”‚   â”‚
â”‚  â”‚   1. Match priority (1-7)                                   â”‚   â”‚
â”‚  â”‚   2. Popularity score DESC                                  â”‚   â”‚
â”‚  â”‚   3. Name alphabetically                                    â”‚   â”‚
â”‚  â”‚ LIMIT: 20 results                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Return results
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RESULTS RENDERING                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Found: Nasi Lemak Rendang Ayam                              â”‚  â”‚
â”‚  â”‚ â€¢ Highlight matching words                                   â”‚  â”‚
â”‚  â”‚ â€¢ Show condition ratings                                     â”‚  â”‚
â”‚  â”‚ â€¢ Display nutrition summary                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  If NO RESULTS:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SearchSuggestions Component                                  â”‚  â”‚
â”‚  â”‚ â€¢ Show "Did you mean: ..."                                   â”‚  â”‚
â”‚  â”‚ â€¢ Display category-based suggestions                         â”‚  â”‚
â”‚  â”‚ â€¢ Show popular searches                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example Flow: "nasi lemak rendang"

```
USER TYPES: "nasi lemak rendang"
     â”‚
     â–¼
[Debounce 300ms]
     â”‚
     â–¼
API: GET /api/foods/search?q=nasi+lemak+rendang
     â”‚
     â–¼
SUPABASE: search_malaysian_foods('nasi lemak rendang', 20)
     â”‚
     â–¼
TOKENIZE: ["nasi", "lemak", "rendang"]
     â”‚
     â–¼
MATCH DATABASE:
  âœ… "Nasi Lemak Rendang Ayam" - Score: 870
     - All words present: +300
     - Contains "nasi": +50
     - Contains "lemak": +50
     - Contains "rendang": +50
     - Popularity (420): +42
  
  âœ… "Nasi Lemak with Rendang" - Score: 850
     - All words present: +300
     - Contains "nasi": +50
     - Contains "lemak": +50
     - Contains "rendang": +50
     - Popularity (350): +35
  
  âœ… "Nasi Lemak (Plain)" - Score: 620
     - Contains "nasi": +50
     - Contains "lemak": +50
     - Popularity (520): +52
     â”‚
     â–¼
SORT BY SCORE: [870, 850, 620, ...]
     â”‚
     â–¼
RETURN TOP 20
     â”‚
     â–¼
RENDER RESULTS:
  1. Nasi Lemak Rendang Ayam â­ (Best match)
  2. Nasi Lemak with Rendang
  3. Nasi Lemak (Plain)
```

---

## Example Flow: "ckt" (Alias)

```
USER TYPES: "ckt"
     â”‚
     â–¼
[Debounce 300ms]
     â”‚
     â–¼
API: GET /api/foods/search?q=ckt
     â”‚
     â–¼
SUPABASE: search_malaysian_foods('ckt', 20)
     â”‚
     â–¼
TOKENIZE: ["ckt"]
     â”‚
     â–¼
MATCH DATABASE:
  âœ… "Char Kuey Teow" - Score: 1200
     - Alias exact match: +1000
     - Alias in array: +200
  
  âŒ Other foods: 0 (no match)
     â”‚
     â–¼
RETURN: ["Char Kuey Teow"]
     â”‚
     â–¼
RENDER RESULTS:
  1. Char Kuey Teow (CKT) ğŸ¯ (Perfect match!)
```

---

## Example Flow: No Results

```
USER TYPES: "xyz123"
     â”‚
     â–¼
[Debounce 300ms]
     â”‚
     â–¼
API: GET /api/foods/search?q=xyz123
     â”‚
     â–¼
SUPABASE: search_malaysian_foods('xyz123', 20)
     â”‚
     â–¼
MATCH: No matches found
     â”‚
     â–¼
RETURN: []
     â”‚
     â–¼
RENDER: SearchSuggestions
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Tiada hasil / No results           â”‚
  â”‚                                    â”‚
  â”‚ ğŸ’¡ Cuba cari:                      â”‚
  â”‚  [nasi lemak] [roti canai]        â”‚
  â”‚  [mee goreng] [teh tarik]         â”‚
  â”‚                                    â”‚
  â”‚ [+ Log Manual Entry]               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Example Flow: Misspelling

```
USER TYPES: "roti chanai"
     â”‚
     â–¼
[Debounce 300ms]
     â”‚
     â–¼
SearchSuggestions checks COMMON_CORRECTIONS
  âœ… "chanai" â†’ "canai"
     â”‚
     â–¼
SHOWS: "Did you mean: roti canai"
     â”‚
     â–¼
USER CLICKS: "roti canai"
     â”‚
     â–¼
SEARCH AGAIN: search_malaysian_foods('roti canai', 20)
     â”‚
     â–¼
MATCH DATABASE:
  âœ… "Roti Canai (Plain)" - Score: 1620
     - Alias exact match: +1000
     - Starts with: +500
     - Popularity (120): +12
     â”‚
     â–¼
RENDER RESULTS:
  1. Roti Canai (Plain) ğŸ¯
  2. Roti Canai Telur
  3. Roti Canai Planta
```

---

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MalaysianFoodSearch                        â”‚
â”‚                   (Full-page modal)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Search Input                                           â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ” [User types query]                              â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚ Results Area (conditional)                             â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ IF results.length > 0:                             â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   â€¢ Show FoodResultCard Ã— N                        â”‚ â”‚  â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ IF results.length === 0 && query.length >= 2:     â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   â€¢ Show "No results" message                      â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   â€¢ Show SearchSuggestions                         â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   â€¢ Show "Log Manual Entry" button                 â”‚ â”‚  â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ IF query.length < 2:                               â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   â€¢ Show recent searches                           â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   â€¢ Show SearchSuggestions (popular)               â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚ SearchSuggestions                                      â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ IF query matches correction:                       â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   "Did you mean: [corrected]"                      â”‚ â”‚  â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ IF query.length > 0:                               â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   Show category-based suggestions                  â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   ["nasi lemak", "nasi goreng", ...]               â”‚ â”‚  â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ IF query.length === 0:                             â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   Show popular searches                            â”‚ â”‚  â”‚
â”‚  â”‚ â”‚   ["nasi lemak", "roti canai", ...]                â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Timeline

```
T=0ms      User types "n"
           â”‚
T=100ms    User types "na"
           â”‚
T=200ms    User types "nasi"
           â”‚ (debounce timer starts)
           â”‚
T=500ms    [DEBOUNCE TRIGGERED - 300ms elapsed]
           â”‚
           â”œâ”€â†’ API Call: /api/foods/search?q=nasi
           â”‚   â””â”€â†’ Supabase: search_malaysian_foods('nasi', 20)
           â”‚       â””â”€â†’ Database query: ~60ms
           â”‚           â””â”€â†’ Return results
           â”‚
T=560ms    API Response received (60ms query)
           â”‚
T=570ms    React renders results (10ms)
           â”‚
T=600ms    âœ… User sees results (100ms total since last keypress)
           â”‚
           â”‚
T=700ms    User types "nasi l"
           â”‚ (cancels previous debounce, starts new)
           â”‚
T=1000ms   [DEBOUNCE TRIGGERED]
           â”‚
           â”œâ”€â†’ API Call: /api/foods/search?q=nasi+l
           â”‚   (Previous call is aborted if still pending)
           â”‚
T=1065ms   âœ… Results updated
```

---

## Performance Optimization Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTIMIZATION POINTS                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ 1. DEBOUNCING (Frontend)                                    â”‚
â”‚    â€¢ Delay: 300ms                                           â”‚
â”‚    â€¢ Prevents: Excessive API calls                          â”‚
â”‚    â€¢ Savings: ~80% fewer requests                           â”‚
â”‚                                                              â”‚
â”‚ 2. REQUEST CANCELLATION (Frontend)                          â”‚
â”‚    â€¢ AbortController                                        â”‚
â”‚    â€¢ Prevents: Stale results                                â”‚
â”‚    â€¢ Savings: Cleaner UX                                    â”‚
â”‚                                                              â”‚
â”‚ 3. DATABASE INDEXES (Backend)                               â”‚
â”‚    â€¢ Lower(name_en), Lower(name_bm)                         â”‚
â”‚    â€¢ GIN on aliases array                                   â”‚
â”‚    â€¢ Full-text search indexes                               â”‚
â”‚    â€¢ Savings: ~90% faster queries                           â”‚
â”‚                                                              â”‚
â”‚ 4. EARLY RETURNS (Algorithm)                                â”‚
â”‚    â€¢ Exact match â†’ return immediately                       â”‚
â”‚    â€¢ Limit to 20 results                                    â”‚
â”‚    â€¢ Savings: No unnecessary computation                    â”‚
â”‚                                                              â”‚
â”‚ 5. CLIENT-SIDE CACHING (Frontend)                           â”‚
â”‚    â€¢ Recent searches in localStorage                        â”‚
â”‚    â€¢ No API call for cached items                           â”‚
â”‚    â€¢ Savings: Instant results                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR SCENARIOS & HANDLING                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ Scenario 1: Network Error                                   â”‚
â”‚   User types â†’ API call fails                               â”‚
â”‚   â”‚                                                          â”‚
â”‚   â”œâ”€â†’ Catch error in hook                                   â”‚
â”‚   â”œâ”€â†’ Set error state                                       â”‚
â”‚   â”œâ”€â†’ Show error message                                    â”‚
â”‚   â””â”€â†’ Keep previous results (if any)                        â”‚
â”‚                                                              â”‚
â”‚ Scenario 2: Database Error                                  â”‚
â”‚   API â†’ Supabase â†’ Query fails                              â”‚
â”‚   â”‚                                                          â”‚
â”‚   â”œâ”€â†’ Return 500 error                                      â”‚
â”‚   â”œâ”€â†’ Frontend catches                                      â”‚
â”‚   â”œâ”€â†’ Show generic error                                    â”‚
â”‚   â””â”€â†’ Log to console                                        â”‚
â”‚                                                              â”‚
â”‚ Scenario 3: Timeout                                         â”‚
â”‚   API call takes > 10s                                      â”‚
â”‚   â”‚                                                          â”‚
â”‚   â”œâ”€â†’ AbortController timeout                               â”‚
â”‚   â”œâ”€â†’ Show timeout message                                  â”‚
â”‚   â””â”€â†’ Suggest try again                                     â”‚
â”‚                                                              â”‚
â”‚ Scenario 4: Empty Results (Not an error!)                   â”‚
â”‚   Valid search, no matches                                  â”‚
â”‚   â”‚                                                          â”‚
â”‚   â”œâ”€â†’ Show "No results" UI                                  â”‚
â”‚   â”œâ”€â†’ Show SearchSuggestions                                â”‚
â”‚   â””â”€â†’ Offer manual entry                                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary: Key Innovation

**The Compound Matching Algorithm:**

```sql
-- Old approach (didn't work):
WHERE name_en ILIKE '%nasi lemak rendang%'
-- âŒ Only finds if exact phrase exists

-- New approach (works!):
WHERE 
  (name_en ILIKE '%nasi%' AND 
   name_en ILIKE '%lemak%' AND 
   name_en ILIKE '%rendang%')
-- âœ… Finds if all words present in any order!
```

This simple change makes ALL the difference! ğŸ‰

---

**Visual Summary:**

```
OLD: "nasi lemak rendang"
     â†“
     Must match exactly: "...nasi lemak rendang..."
     âŒ Fails for "Nasi Lemak Rendang Ayam"

NEW: "nasi lemak rendang"
     â†“
     Split into: ["nasi", "lemak", "rendang"]
     â†“
     Match if contains: "nasi" AND "lemak" AND "rendang"
     âœ… Finds "Nasi Lemak Rendang Ayam" âœ¨
```

---

**This flow diagram explains the entire system!** ğŸ“Š

